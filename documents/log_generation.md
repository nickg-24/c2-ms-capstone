# Full Log Generation Workflow for Zeek & Suricata
This workflow will cover:
1. **Directory Structure**
2. **Commands for Running Zeek & Suricata**
3. **Expected Output Files**

---

## 1. Directory Structure
Logs and PCAP files are organized like this:
```
~/docker-zeek-suricata/
│── pcaps/                          # Store raw PCAPs here
│   ├── {capture_name}.pcapng
│── logs/                           # All logs (separated per capture)
│   ├── {capture_name}/             # Logs for this PCAP
│   │   ├── zeek/                   # Zeek logs
│   │   ├── suricata/               # Suricata logs
│── rules/                          # Suricata ruleset (ET Open)
│   ├── emerging-all.rules
│── docker-compose.yml              # Runs Zeek & Suricata
│── suricata.yaml                   # Custom Suricata config
```
**Each PCAP has its own subdirectory in `logs/` to keep logs organized.**  
**Zeek logs go inside `logs/{capture_name}/zeek/`**.  
**Suricata logs go inside `logs/{capture_name}/suricata/`**.  
**`rules/` contains Suricata’s ruleset** (mounted in the container).  

---

## 2. Commands for Running Zeek & Suricata
### Step 1: Start Docker Containers
```bash
cd ~/docker-zeek-suricata
docker-compose up -d
```  

---

### Step 2: Prepare a New PCAP for Analysis
Make sure the PCAP is in the `pcaps/` directory:

Create a directory for logs:
```bash
mkdir  /docker-zeek-suricata/logs/{capture_name}/zeek
mkdir /docker-zeek-suricata/logs/{capture_name}/suricata
```
**This keeps logs separate for each capture.**  

---

### Step 3: Run Zeek on the PCAP
```bash
docker exec -it zeek /bin/bash
cd /logs/{capture_name}/zeek/
zeek -r /pcaps/{capture_name}.pcapng -C
exit
```
**Expected Output (Inside `/logs/{capture_name}/zeek/`)**
```
conn.log       # Zeek's network flow logs
dns.log        # DNS request/response logs
http.log       # HTTP request logs
ssl.log        # TLS/SSL handshake logs
files.log      # Metadata about extracted files
```
**Zeek logs all network flows for ML model training.**  
**Used for extracting labeled network flow data.**  

---

### Step 4: Run Suricata on the PCAP
```bash
docker exec -it suricata /bin/bash
cd /logs/{capture_name}/suricata/
suricata -r /pcaps/{capture_name}.pcapng -S /etc/suricata/rules/4-17-emerging-all.rules
exit
```
The `-S` option explicitly tells suricata which ruleset to check against. I opted for the ET Open Ruleset which covers a wide variety of signatures, include c2 traffic. I used the version for suricates 7.0.3, updated on 7/17/2025 

**Expected Output (Inside `/logs/{capture_name}/suricata/`)**
```
eve.json        # Main Suricata event log (contains alerts)
fast.log        # Text-based summary of alerts
stats.log       # Performance statistics
tls.log         # TLS metadata (like Zeek's `ssl.log`)
http.log        # HTTP metadata (like Zeek's `http.log`)
```
**`eve.json` contains alerts triggered by Suricata rules.**  
**`fast.log` provides a human-readable summary of detections.**  

---


### Step 5: Stop Containers When Done
```bash
docker-compose down --remove-orphans
```
✅ **Stops Zeek & Suricata but keeps logs intact.**  

---

## 3. Expected Outputs & Comparison
| **Log Type** | **Generated By** | **Purpose** |
|-------------|----------------|------------|
| `conn.log` | Zeek | Extracts labeled network flows for ML training. |
| `http.log` | Zeek & Suricata | Logs HTTP metadata (useful for detecting C2 traffic). |
| `tls.log` | Zeek & Suricata | Logs encrypted session details. |
| `fast.log` | Suricata | Human-readable detection summary. |
| `eve.json` | Suricata | Detailed JSON-based alert log. |



---
